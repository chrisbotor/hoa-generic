- name: ðŸš€ Update Containers & Sync Config
        run: |
          # 1. Create .env with JBoss LogManager fix
          printf "DB_USER=${{ secrets.DB_USER }}\nDB_PASS=${{ secrets.DB_PASS }}\nHASURA_URL=http://192.168.100.80:8080/v1/graphql\nHASURA_ADMIN_SECRET=${{ secrets.HASURA_SECRET }}\nJAVA_OPTS=-Djava.util.logging.manager=org.jboss.logmanager.LogManager\n" > .env
          
          # 2. CREATE the docker-compose.yml dynamically to ensure path accuracy
          cat << 'EOF' > docker-compose.yml
          services:
            hoa-app:
              image: eclipse-temurin:21-jre-jammy
              container_name: hoa-quarkus-app
              volumes:
                - ./target/quarkus-app:/deployments:z
              working_dir: /deployments
              environment:
                - JAVA_OPTS=${JAVA_OPTS}
              command: java ${JAVA_OPTS} -jar /deployments/quarkus-run.jar
              ports:
                - "8081:8080"
              restart: always

            hoa-tunnel:
              image: cloudflare/cloudflared:latest
              container_name: hoa-cloudflared
              command: tunnel --url http://hoa-quarkus-app:8080
              restart: always
          EOF

          # 3. Deploy using the freshly created files
          sudo /usr/bin/docker compose up -d --build --force-recreate --remove-orphans
          
          # 4. Cleanup storage
          rm .env
          sudo /usr/bin/docker image prune -f
          sudo rm -rf $GITHUB_WORKSPACE/target
