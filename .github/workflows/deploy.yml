name: HOA Portal Deployment

on:
  push:
    branches: [ main ]
  workflow_dispatch: # <--- This adds the manual "Run workflow" button

jobs:
  deploy:
    runs-on: self-hosted # Forces the job to run on your Beelink runner

    steps:
      - name: ðŸ“¥ Pull Code
        uses: actions/checkout@v4

      - name: â˜• Build Java App
        run: mvn package -U -DskipTests # Compiles the .jar file

      - name: ðŸš€ Update Containers
        env:
          # Injects secrets into the deployment environment
          HASURA_ADMIN_SECRET: ${{ secrets.HASURA_ADMIN_SECRET }}
          HASURA_URL: ${{ secrets.HASURA_URL }}
        run: |
          docker compose down
          docker image prune -f
          docker compose up -d --build
          docker system prune -f # Saves space on your 500GB NVMe
