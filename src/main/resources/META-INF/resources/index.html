<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HOA Portal - Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">

    <div id="dashboard" class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
        <h1 class="text-2xl font-bold mb-4">Maintenance Requests</h1>
        <div id="ticket-container" class="space-y-2">
            <p class="text-gray-500 italic">Connecting to Beelink server...</p>
        </div>
        <button onclick="loadTickets()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Refresh Data</button>
    </div>

    <script>
        const API = "http://192.168.100.81:8081/portal";

        async function loadTickets() {
            try {
                const res = await fetch(`${API}/tickets`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                    // No Authorization header needed while @PermitAll is active
                });

                if (res.ok) {
                    const data = await res.json();
                    const container = document.getElementById('ticket-container');
                    
                    if (data.length === 0) {
                        container.innerHTML = "<p>No tickets found in hoa.maintenance_requests table.</p>";
                    } else {
                        container.innerHTML = data.map(t => `
                            <div class="p-3 bg-gray-50 border-l-4 border-blue-500 rounded">
                                <strong>${t.title}</strong> - Status: ${t.status}
                            </div>
                        `).join('');
                    }
                } else {
                    document.getElementById('ticket-container').innerText = "Error: Server returned " + res.status;
                }
            } catch (e) {
                document.getElementById('ticket-container').innerText = "Connection failed. Is Quarkus running?";
            }
        }

        // Load immediately on page open
        loadTickets();
    </script>
</body>
</html>